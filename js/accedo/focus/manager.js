accedo.define("accedo.focus.manager",["accedo.utils.array","accedo.app"],function(){var a=(function(){var d=null;var c=[];var b=function(){var e;accedo.utils.array.each(c,function(f){if(f.component==d){e=f;throw accedo.$break;}},this);return e||null;};return{isComponentInDOMTree:function(e){if(e==accedo.app.getCurrentController()){return true;}var f=e.getParent();if(f){do{if(!f.getHTMLElement){f=f.getRoot();}if(f.getHTMLElement()==accedo.app.getRoot().getHTMLElement()){return true;}f=f.getParent();}while(f);}return false;},updateFocusMap:function(){accedo.utils.array.each(c,function(f){var e=f.component.getRoot();var g=e.cumulativeOffset();f.x=g.x;f.y=g.y;f.width=parseInt(e.getStyle("width"));f.height=parseInt(e.getStyle("height"));},this);},registerComponent:function(f){if(this.isComponentInDOMTree(f)){var e=f.getRoot();var g=e.cumulativeOffset();c.push({component:f,x:g.x,y:g.y,width:parseInt(e.getStyle("width")),height:parseInt(e.getStyle("height"))});}},unregisterComponent:function(e){c=accedo.utils.array.filter(c,function(f){return f.component!=e;},this);},requestFocus:function(e){if(d){d.blur();}d=e;d.focus();},getCurrentFocus:function(){if(d){return d;}else{return null;}},focusDirectionChange:function(j){var k;var h=accedo.app.getCurrentController();if(d){var g;if(j===a.FOCUS_UP){g="nextUp";}else{if(j===a.FOCUS_DOWN){g="nextDown";}else{if(j===a.FOCUS_LEFT){g="nextLeft";}else{if(j===a.FOCUS_RIGHT){g="nextRight";}}}}g=d.getOption(g);if(!accedo.utils.object.isUndefined(g)){if(g===null){return;}k=h.get(g);}else{var i=b();var e;if(!i){return;}var f=accedo.utils.array.filter(c,function(l){if(i==l){return false;}if(j===a.FOCUS_UP){if((l.y+l.height)<=i.y){return true;}}else{if(j===a.FOCUS_DOWN){if(l.y>=(i.y+i.height)){return true;}}else{if(j===a.FOCUS_LEFT){if((l.x+l.width)<=i.x){return true;}}else{if(j===a.FOCUS_RIGHT){if(l.x>=(i.x+i.width)){return true;}}}}}return false;},this);if(f.length==1){e=f[0];}else{accedo.utils.array.each(f,function(l){if(!e){e=l;}if(j===a.FOCUS_UP){if(e&&e.y<l.y){e=l;}}else{if(j===a.FOCUS_DOWN){if(e&&e.y>l.y){e=l;}}else{if(j===a.FOCUS_LEFT){if(e&&e.x<l.x){e=l;}}else{if(j===a.FOCUS_RIGHT){if(e&&e.x>l.x){e=l;}}}}}},this);}if(e){k=e.component;}}}if(k){this.requestFocus(k);return true;}else{return false;}}};})();a.FOCUS_UP=1;a.FOCUS_DOWN=2;a.FOCUS_LEFT=4;a.FOCUS_RIGHT=8;return a;});