accedo.define("nfb.controllers.detailviewSubcontroller",["accedo.utils.object","accedo.ui.controller","nfb.views.detailSubview","accedo.utils.ajax"],function(){return function(a){var b;return accedo.utils.object.extend(accedo.ui.controller(a),{dragDealerCurrent:0,isDragging:false,out:false,dragToLocation:function(d){var c=this;if(d!=c.dragDealerCurrent){return;}else{c.dragDealerCurrent=-1;c.isDragging=false;}},onCreate:function(aa){var r=this;r.setView(nfb.views.detailSubview);accedo.app.getCurrentController().get("loading_subcontroller").root.setStyle({display:"block"});nfb.config.currentSubcontroller=7;var C=this.get("detail_preview");var l=this.get("detail_title");var J=this.get("detail_director");var S=this.get("detail_time");var q=this.get("detail_description");var c=this.get("detail_related");var A=this.get("detail_video");var v=this.get("detail_fav");var j;var i=accedo.app.getCurrentController().get("layer");i.show();if(localStorage.getItem("zlang")=="fr"){c.setSrc("image/btn_rel_fr_default.png");}else{c.setSrc("image/related.png");}for(var Q=1;Q<8;Q++){var o="cat"+Q;accedo.app.getCurrentController().get(o).setOption("nextRight","detail_video");}var B;A.setOption("nextLeft","cat"+(nfb.config.selected+1));try{B=SERVER.getJSON(nfb.config.url+nfb.config.API_film+nfb.config.film+nfb.config.API_key+nfb.config.API_key1);}catch(V){alert("ERROR:unable to connect the server.Please try again.");this.get("detail").hide();accedo.utils.fn.delay(function(){accedo.focus.manager.requestFocus(accedo.app.getCurrentController().get("cat1"));},0.01);return;}U();if(nfb.config.usingmouse==false){accedo.utils.fn.delay(function(){accedo.focus.manager.requestFocus(r.get("detail_video"));},0.01);}else{accedo.focus.manager.getCurrentFocus().blur();}var W=B.data.film.big_thumbnail;var P=B.data.film.thumbnail;var H=B.data.film.title;var h=B.data.film.director;var R=B.data.film.time;var k=B.data.film.year;var x=B.data.film.description.replace(/<.*?>/g,"");var z=B.data.film.slug;var n=null;if(B.data.film.mobile_urls_versions.HD){n=B.data.film.mobile_urls_versions.HD;}else{if(B.data.film.mobile_urls_versions.HQ){n=B.data.film.mobile_urls_versions.HQ;}else{if(B.data.film.mobile_urls_versions.vanilla){n=B.data.film.mobile_urls_versions.vanilla;}}}nfb.config.temp=H;new_time=X(R)+","+k;if(localStorage.getItem(z)){v.setSrc("image/fav_selected.png");}else{v.setSrc("image/star.png");}var N="background-image:url("+W+"); background-repeat: no-repeat;background-size: 1280px 622px";document.body.setAttribute("style",N);C.setSrc(P);l.setText(H);J.setText(h);S.setText(new_time);q.setText(x+" <br> ");A.onFocus=function(){U();A.setSrc("image/play_focus.png");accedo.app.getCurrentController().get("progress_bar_subcontroller").root.setStyle({display:"none"});if(nfb.config.usingmosue==true){accedo.focus.manager.getCurrentFocus().blur();}};A.onBlur=function(){A.setSrc("image/play.png");};v.onBlur=function(){if(localStorage.getItem(z)){v.setSrc("image/fav_selected.png");}else{v.setSrc("image/star.png");}};v.onFocus=function(){U();if(localStorage.getItem(z)){v.setSrc("image/fav_selected_focused.png");}else{v.setSrc("image/fav_focus.png");}};c.onBlur=function(){if(localStorage.getItem("zlang")=="fr"){c.setSrc("image/btn_rel_fr_default.png");}else{c.setSrc("image/related.png");}};c.onFocus=function(){U();if(localStorage.getItem("zlang")=="fr"){c.setSrc("image/btn_rel_fr_focus.png");}else{c.setSrc("image/rel_focus.png");}};c.addEventListener("click",function(){Z();});c.root.addEventListener("click",function(){Z();});v.root.addEventListener("click",function(){y();});v.addEventListener("click",function(){y();});A.root.addEventListener("click",function(){M();});A.addEventListener("click",function(){M();});function T(){accedo.device.manager.unregisterKey("back");accedo.device.manager.registerKey("back",function(){accedo.device.manager.unregisterKey("back");accedo.device.manager.registerKey("back",function(){nfb.config.backto();});if(nfb.config.usingmouse==true){accedo.utils.fn.delay(function(){accedo.focus.manager.getCurrentFocus().blur();},0.2);}else{accedo.utils.fn.delay(function(){accedo.focus.manager.requestFocus(accedo.app.getCurrentController().get("detail_video"));},0.1);}for(var e=0;e<4;e++){nfb.config.APICallFlag[e]=true;}lgVideoPlayer.destroyPlayer();nfb.config.hideProgressBar();nfb.config.playingVideo=false;accedo.app.getCurrentController().get("loading_subcontroller").root.setStyle({display:"none"});accedo.device.manager.unregisterKey("enter");});}function L(){accedo.app.getCurrentController().get("loading_subcontroller").root.setStyle({display:"block"});accedo.app.getCurrentController().get("progress_subcontroller").getInstance().reInit();nfb.config.showProgressBar();accedo.app.getCurrentController().get("durTime").setText("0:00:00");nfb.config.playingVideo=true;lgVideoPlayer.generatePlayer({width:1280,height:720,left:0,top:0,parent:null,url:n,autoStart:true,onLoadCallback:function(){lgVideoPlayer.play();window.NetCastSetDefaultAspectRatio("original");},onCurTimeCallback:function(ad,ae,af,ac,p){var ab=lgVideoPlayer.formatCurTime(ad,ae,false);accedo.app.getCurrentController().get("progress_subcontroller").getInstance().updateStatus(true,ad,ae,af,ab.current,ab.duration);accedo.app.getCurrentController().get("progress_subcontroller").getInstance().updateRadar(ac,p);if(ae!=0){if(ad<ae*0.01+1000&&ad>ae*0.01-1000){if(nfb.config.APICallFlag[0]==true){nfb.config.APICallFlag[0]=false;var e=nfb.config.url+nfb.config.API_stat+z;accedo.utils.ajax.request(e,{method:"post",parameters:accedo.utils.hash({api_key:nfb.config.API_key1,platform:"LG_SMART_TV",event:"percentPoint reached: 1"}),onSuccess:function(ag){}});}}else{if(ad<ae*0.25+1000&&ad>ae*0.25-1000){if(nfb.config.APICallFlag[1]==true){nfb.config.APICallFlag[1]=false;var e=nfb.config.url+nfb.config.API_stat+z;accedo.utils.ajax.request(e,{method:"post",parameters:accedo.utils.hash({api_key:nfb.config.API_key1,platform:"LG_SMART_TV",event:"percentPoint reached: 25"}),onSuccess:function(ag){}});}}else{if(ad<ae*0.5+1000&&ad>ae*0.5-1000){if(nfb.config.APICallFlag[2]==true){nfb.config.APICallFlag[2]=false;var e=nfb.config.url+nfb.config.API_stat+z;accedo.utils.ajax.request(e,{method:"post",parameters:accedo.utils.hash({api_key:nfb.config.API_key1,platform:"LG_SMART_TV",event:"percentPoint reached: 50"}),onSuccess:function(ag){}});}}else{if(ad<ae*0.75+1000&&ad>ae*0.75-1000){if(nfb.config.APICallFlag[3]==true){nfb.config.APICallFlag[3]=false;var e=nfb.config.url+nfb.config.API_stat+z;accedo.utils.ajax.request(e,{method:"post",parameters:accedo.utils.hash({api_key:nfb.config.API_key1,platform:"LG_SMART_TV",event:"percentPoint reached: 75"}),onSuccess:function(ag){}});}}}}}}},onPlayStateCallback:function(p){switch(p){case 1:accedo.app.getCurrentController().get("loading_subcontroller").root.setStyle({display:"none"});break;case 3:break;case 4:accedo.app.getCurrentController().get("loading_subcontroller").root.setStyle({display:"block"});break;case 5:var e=nfb.config.url+nfb.config.API_stat+z;accedo.utils.ajax.request(e,{method:"post",parameters:accedo.utils.hash({api_key:nfb.config.API_key1,platform:"LG_SMART_TV",event:"percentPoint reached: 100"}),onSuccess:function(ab){}});accedo.device.manager.unregisterKey("enter");accedo.focus.manager.getCurrentFocus().blur();nfb.config.playingVideo=false;if(nfb.config.usingmouse==false){accedo.utils.fn.delay(function(){accedo.focus.manager.requestFocus(accedo.app.getCurrentController().get("detail_video"));},0.1);}accedo.app.getCurrentController().get("loading_subcontroller").root.setStyle({display:"none"});nfb.config.hideProgressBar();lgVideoPlayer.destroyPlayer();accedo.app.getCurrentController().get("progress_bar_subcontroller").root.setStyle({display:"none"});accedo.device.manager.unregisterKey("enter");accedo.device.manager.unregisterKey("back");accedo.device.manager.registerKey("back",function(){nfb.config.backto();});accedo.app.getCurrentController().get("loading_subcontroller").root.removeEventListener("click");break;case 0:accedo.device.manager.unregisterKey("enter");accedo.focus.manager.getCurrentFocus().blur();accedo.app.getCurrentController().get("progress_bar_subcontroller").root.setStyle({display:"none"});nfb.config.playingVideo=false;if(nfb.config.usingmouse==false){accedo.utils.fn.delay(function(){accedo.focus.manager.requestFocus(accedo.app.getCurrentController().get("detail_video"));},0.1);}accedo.app.getCurrentController().get("loading_subcontroller").root.setStyle({display:"none"});nfb.config.hideProgressBar();lgVideoPlayer.destroyPlayer();accedo.device.manager.unregisterKey("back");accedo.device.manager.registerKey("back",function(){nfb.config.backto();});accedo.app.getCurrentController().get("loading_subcontroller").root.removeEventListener("click");break;case 2:accedo.app.getCurrentController().get("loading_subcontroller").root.setStyle({display:"none"});break;case 6:accedo.device.manager.unregisterKey("enter");accedo.app.getCurrentController().get("loading_subcontroller").root.setStyle({display:"block"});break;default:break;}},onStopCallback:function(){accedo.app.getCurrentController().get("progress_subcontroller").getInstance().updateStatus(false);},setConfig:function(p,e,ac,ab){}});document.getElementById("lgVideoPlayer").addEventListener("click",function(){nfb.config.showProgressBar();});accedo.app.getCurrentController().get("loading_subcontroller").root.addEventListener("click",function(){if(nfb.config.playingVideo){nfb.config.showProgressBar();}else{accedo.device.manager.unregisterKey("enter");}});accedo.app.getCurrentController().get("progress_bar_subcontroller").root.addEventListener("mousemove",function(){if(nfb.config.timer!=null){clearTimeout(nfb.config.timer);}nfb.config.timer=accedo.utils.fn.delay(function(){window.NetCastMouseOff(1);accedo.device.manager.registerKey("enter",function(){if(nfb.config.playingVideo){nfb.config.showProgressBar();}else{accedo.device.manager.unregisterKey("enter");}});accedo.app.getCurrentController().get("progress_bar_subcontroller").root.setStyle({display:"none"});},5);});accedo.app.getCurrentController().get("loading_subcontroller").root.addEventListener("mousemove",function(){if(nfb.config.timer!=null){clearTimeout(nfb.config.timer);}nfb.config.timer=accedo.utils.fn.delay(function(){window.NetCastMouseOff(1);accedo.device.manager.registerKey("enter",function(){if(nfb.config.playingVideo){nfb.config.showProgressBar();}else{accedo.device.manager.unregisterKey("enter");}});accedo.app.getCurrentController().get("progress_bar_subcontroller").root.setStyle({display:"none"});},5);});document.getElementById("lgVideoPlayer").addEventListener("mousemove",function(){if(nfb.config.timer!=null){clearTimeout(nfb.config.timer);}nfb.config.timer=accedo.utils.fn.delay(function(){window.NetCastMouseOff(1);accedo.device.manager.registerKey("enter",function(){if(nfb.config.playingVideo){nfb.config.showProgressBar();}else{accedo.device.manager.unregisterKey("enter");}});accedo.app.getCurrentController().get("progress_bar_subcontroller").root.setStyle({display:"none"});},5);});}function y(){if(localStorage.getItem(z)){localStorage.removeItem(z);v.setSrc("image/fav_focus.png");var ac=localStorage.getItem("fav");if(ac==null||ac==""){var ab=new Array();}else{var ab=JSON.parse(localStorage.getItem("fav"));var e=ab.indexOf(z);ab.splice(e,1);}localStorage.setItem("fav",JSON.stringify(ab));}else{localStorage.setItem(z,JSON.stringify({title:H,thumbnail:P,length:R,year:k,director:h}));var p=localStorage.getItem("fav");if(p==null||p==""){var ad=new Array();}else{var ad=JSON.parse(localStorage.getItem("fav"));}ad.push(z);localStorage.setItem("fav",JSON.stringify(ad));v.setSrc("image/fav_selected_focused.png");}}function Z(){nfb.config.history.push(7);nfb.config.film_history.push(nfb.config.film);nfb.config.temp_film=B;nfb.config.related_film_name.push(nfb.config.temp);nfb.config.related_start_id.push(0);nfb.config.related_focus_id.push(0);nfb.config.currentSubcontroller=8;accedo.define(null,["nfb.controllers.mostviewedSubcontroller"],function(){});accedo.app.getCurrentController().get("subcontroller").changeToController(nfb.controllers.mostviewedSubcontroller);accedo.focus.manager.requestFocus(accedo.app.getCurrentController().get("list1"));}window.onmouseup=function(){if(r.out==true){r.get("detail_scroll").root.setStyle({background:"gray"});}};var F;var u;var w;var I;var t;var f;var D=this.get("detail_scroll");D.root.addClass("handle");D.root.addEventListener("mouseover",function(){r.out=false;D.root.setStyle({background:"orange"});});D.root.addEventListener("mouseout",function(){r.out=true;if(r.isDragging==false){D.root.setStyle({background:"gray"});}});this.addEventListener("attach",function(){t=document.getElementById("detail_screen");F=document.getElementById("detail_description");u=document.getElementById("detail_scroll");accedo.utils.fn.defer(function(){b=new Dragdealer("detail_scroll_container",{snap:false,speed:100,horizontal:false,slide:true,vertical:true,animationCallback:function(ab,ad){if(r.isDragging==true){D.root.setStyle({background:"orange"});}r.isDragging=true;var ac=Math.round(ad*(F.offsetHeight-150));F.style.top=-ac+"px";r.dragDealerCurrent=ac;accedo.utils.fn.delay(function(){r.dragToLocation(ac);},0.1);}});});f=document.getElementById("detail_scroll_bg");var e=document.getElementById("upbtn");var p=document.getElementById("downbtn");j=F.offsetHeight;if(j>270){u.style.display="block";f.style.display="block";e.style.display="block";p.style.display="block";}else{u.style.display="none";f.style.display="none";e.style.display="none";p.style.display="none";}w=t.offsetHeight/F.offsetHeight;if(w>1){w=1;}I=130*w;u.style.height=I+"px";});var G=this.get("upbtn");var O=this.get("downbtn");O.addEventListener("click",function(){s();});O.root.addEventListener("click",function(){s();});G.addEventListener("click",function(){K();});G.root.addEventListener("click",function(){K();});G.onFocus=function(){G.setSrc("image/upbtn_focus.png");};O.onFocus=function(){O.setSrc("image/downbtn_focus.png");};G.onBlur=function(){G.setSrc("image/upbtn.png");};O.onBlur=function(){O.setSrc("image/downbtn.png");};this.addEventListener("detach",function(){});function M(){accedo.app.getCurrentController().get("loading_subcontroller").root.setStyle({display:"block"});if(n==null||n==""){d();accedo.app.getCurrentController().get("loading_subcontroller").root.setStyle({display:"none"});return;}if(localStorage.getItem("zlang")=="fr"){accedo.app.getCurrentController().get("video_back").setText("Retour");}else{if(localStorage.getItem("zlang")=="en"){accedo.app.getCurrentController().get("video_back").setText("Back");}}var e=nfb.config.url+nfb.config.API_stat+z;accedo.utils.ajax.request(e,{method:"post",parameters:accedo.utils.hash({api_key:nfb.config.API_key1,platform:"LG_SMART_TV",event:"start playing"}),onSuccess:function(p){}});nfb.config.vp_click=false;accedo.utils.fn.delay(function(){L();});T();accedo.device.manager.unregisterKey("enter");}function d(){accedo.device.manager.unregisterKey("up");accedo.device.manager.unregisterKey("down");var p;if(localStorage.getItem("zlang")=="fr"){p="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sorry.No available videos.";}else{p="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sorry.No available videos.";}var ad=new nfb.ui.container({id:"detail_block",htmlid:"detail_block"});var e=new nfb.ui.container({id:"pop",htmlid:"pop"});var ac=new accedo.ui.label({id:"pop_msg",htmlid:"pop_msg",text:p});var ab=new nfb.ui.button({id:"pop_ok",htmlid:"pop_ok",text:"ok",nextLeft:"",nextRight:"",nextDown:"back",nextUp:""});accedo.app.getCurrentController().get("detail").append(ad);accedo.app.getCurrentController().get("detail_block").root.getHTMLElement().setAttribute("style","background-color:white;opacity:0.7");accedo.app.getCurrentController().get("detail").append(e);accedo.app.getCurrentController().get("pop").root.getHTMLElement().setAttribute("style","top:300px");accedo.app.getCurrentController().get("pop").append(ac);accedo.app.getCurrentController().get("pop").append(ab);accedo.app.getCurrentController().get("pop_ok").root.getHTMLElement().setAttribute("style","top:-20px");accedo.app.getCurrentController().get("lg_lang").setOption("nextUp","pop_ok");accedo.app.getCurrentController().get("back").setOption("nextUp","pop_ok");accedo.app.getCurrentController().get("exit").setOption("nextUp","pop_ok");accedo.focus.manager.getCurrentFocus().blur();if(nfb.config.usingmouse==false){accedo.utils.fn.defer(function(){accedo.focus.manager.requestFocus(accedo.app.getCurrentController().get("pop_ok"));});}else{accedo.focus.manager.requestFocus(accedo.app.getCurrentController().get("pop_ok"));accedo.focus.manager.getCurrentFocus().blur();}ab.addEventListener("click",function(){accedo.app.getCurrentController().get("detail").remove(e);accedo.app.getCurrentController().get("detail").remove(ad);if(nfb.config.usingmouse==false){accedo.utils.fn.defer(function(){accedo.focus.manager.requestFocus(accedo.app.getCurrentController().get("detail_video"));});}accedo.app.getCurrentController().get("lg_lang").setOption("nextUp","cat7");accedo.app.getCurrentController().get("exit").setOption("nextUp","cat7");accedo.app.getCurrentController().get("back").setOption("nextUp","cat7");});ab.root.addEventListener("mouseout",function(){ab.blur();});ab.onFocus=function(){accedo.device.manager.unregisterKey("up");accedo.device.manager.unregisterKey("down");};}function U(){accedo.device.manager.unregisterKey("up");accedo.device.manager.unregisterKey("down");accedo.device.manager.registerKey("up",function(){K();});accedo.device.manager.registerKey("down",function(){s();});}function K(){if(w<1){var e=F.offsetTop;if(e+70>0){e=0;}else{e+=70;}F.style.top=e+"px";var p=-(F.offsetTop/(F.offsetHeight))*f.offsetHeight;if(p<0){p=0;}u.style.top=p+"px";}}function s(){if(w<1){var e=F.offsetTop;if(e-70<-(F.offsetHeight-150)){e=-(F.offsetHeight-150);}else{e-=70;}F.style.top=e+"px";var p=-(F.offsetTop/(F.offsetHeight))*f.offsetHeight;if(p>550-u.offsetHeight){p=550-u.offsetHeight;}u.style.top=p+"px";}}function X(ac){var p=0;var ab=0;var e=ac.split(" ").join("");if(e.indexOf("min")>0){var ad=e.split("min");p=parseInt(ad[0]);}if(e.indexOf("s")>0){ab=parseInt(ad[1].split("s")[0]);}if(p<10){p="0"+p;}if(ab<10){ab="0"+ab;}ac=p+":"+ab;return ac;}v.root.addEventListener("mouseout",function(){v.blur();});c.root.addEventListener("mouseout",function(){c.blur();});A.root.addEventListener("mouseout",function(){A.blur();});O.root.addEventListener("mouseout",function(){O.blur();});G.root.addEventListener("mouseout",function(){G.blur();});var E=accedo.app.getCurrentController().get("back");var g=accedo.app.getCurrentController().get("exit");var m=accedo.app.getCurrentController().get("lg_lang");m.onFocus=function(){accedo.device.manager.unregisterKey("up");accedo.device.manager.unregisterKey("down");};E.onFocus=function(){accedo.device.manager.unregisterKey("up");accedo.device.manager.unregisterKey("down");};g.onFocus=function(){accedo.device.manager.unregisterKey("up");accedo.device.manager.unregisterKey("down");};E.onBlur=function(){U();};g.onBlur=function(){U();};m.onBlur=function(){U();};var Y=[];for(var Q=0;Q<14;Q++){Y[Q]=new Image();}Y[0].src="image/videoplayer/backbtn.png";Y[1].src="image/videoplayer/backbtnhl.png";Y[2].src="image/videoplayer/button_pause.png";Y[3].src="image/videoplayer/button_pause_focus.png";Y[4].src="image/videoplayer/button_play.png";Y[5].src="image/videoplayer/button_play_focus.png";Y[6].src="image/videoplayer/button_stop.png";Y[7].src="image/videoplayer/button_stop_focus.png";Y[8].src="image/videoplayer/fbtn.png";Y[9].src="image/videoplayer/fbtnhl.png";Y[10].src="image/videoplayer/qmenubtnhl.png";Y[11].src="image/videoplayer/qmenubtn.png";Y[12].src="image/videoplayer/rbtn.png";Y[13].src="image/videoplayer/rbtnhl.png";accedo.app.getCurrentController().get("loading_subcontroller").root.setStyle({display:"none"});accedo.define(null,["nfb.controllers.aboutSubcontroller","nfb.controllers.searchSubcontroller","nfb.controllers.mostviewedSubcontroller","nfb.controllers.channelSubcontroller"],function(){});}});};});