accedo.define("nfb.controllers.channelSubcontroller",["accedo.utils.object","accedo.ui.controller","nfb.views.channelSubview","nfb.controllers.mostviewedSubcontroller"],function(){return function(opts){return accedo.utils.object.extend(accedo.ui.controller(opts),{onCreate:function(context){var self=this;self.setView(nfb.views.channelSubview);accedo.app.getCurrentController().get("loading_subcontroller").root.setStyle({display:"block"});var start=nfb.config.channel_start_id.pop();try{var result=SERVER.getJSON(nfb.config.url+nfb.config.API_channel+nfb.config.API_key+nfb.config.API_key1+"&platform=lg_tv");}catch(e){alert("ERROR:unable to connect the server.Please try again.");this.get("channelSubview").hide();accedo.utils.fn.delay(function(){accedo.focus.manager.requestFocus(accedo.app.getCurrentController().get("cat4"));},0.01);return;}var no=result.data.length;var current_block=0;var result_label=this.get("channel_result");var result_group=[];var counter=0;for(var i=0;i<no;i++){if(result.data[i].slug!="most_popular"&&result.data[i].slug!="kids_movies"&&result.data[i].slug!="jeunesse"&&result.data[i].slug!="plus_vus"){var temp={slug:result.data[i].slug,title:result.data[i].title,thumbnail:result.data[i].thumbnail};var tempimg=new Image();tempimg.src=result.data[i].thumbnail;result_group[counter]=temp;counter++;}}var ch=[];var ch_label=[];ch=[this.get("ch1"),this.get("ch2"),this.get("ch3"),this.get("ch4"),this.get("ch5"),this.get("ch6")];ch_label=[this.get("ch1_label"),this.get("ch2_label"),this.get("ch3_label"),this.get("ch4_label"),this.get("ch5_label"),this.get("ch6_label")];var up=this.get("channel_up");var down=this.get("channel_down");showchannel(start);function pageupdown(){accedo.device.manager.unregisterKey("pagedown");accedo.device.manager.registerKey("pagedown",function(){if(start+6<result_group.length){start=start+6;showchannel(start);}});accedo.device.manager.unregisterKey("pageup");accedo.device.manager.registerKey("pageup",function(){if(start-6>-1){start=start-6;showchannel(start);}});}function showchannel(start_id){if(start_id<=0){up.hide();}else{up.show();}if(start_id+6>=no-2-1){down.hide();}else{down.show();}var temp;if(eval(start_id+6)>eval(result_group.length)){temp=eval(result_group.length);}else{temp=eval(start_id+6);}if(localStorage.getItem("zlang")=="fr"){result_label.setText(eval(start_id+1)+"-"+temp+" sur "+result_group.length+" cha&icirc;nes");}else{result_label.setText(eval(start_id+1)+"-"+temp+" of "+result_group.length+" channels");}if(result_group.length>start_id){get(0,start_id);ch[0].onFocus=function(){ch[0].setFocus("image/ch_focus.png");pageupdown();current_block=0;accedo.device.manager.unregisterKey("right");accedo.device.manager.unregisterKey("left");accedo.device.manager.unregisterKey("up");accedo.device.manager.unregisterKey("down");if(start+1==result_group.length){ch[1].hide();ch_label[1].hide();}if(start+2==result_group.length){ch[2].hide();ch_label[2].hide();}if(start+3==result_group.length){ch[3].hide();ch_label[3].hide();}if(start+4==result_group.length){ch[4].hide();ch_label[4].hide();}if(start+5==result_group.length){ch[5].hide();ch_label[5].hide();}if(start-6>-1){accedo.device.manager.registerKey("left",function(){start=start-6;showchannel(start);accedo.focus.manager.requestFocus(ch[5]);});}if(start-6>-1){accedo.device.manager.registerKey("up",function(){start=start-6;showchannel(start);accedo.focus.manager.requestFocus(ch[3]);});}if(start+3<result_group.length){accedo.device.manager.registerKey("down",function(){accedo.focus.manager.requestFocus(ch[3]);});}else{accedo.device.manager.registerKey("down",function(){});}if(start+1>=result_group.length){accedo.device.manager.registerKey("right",function(){accedo.focus.manager.requestFocus(ch[0]);ch[1].hide();ch_label[1].hide();ch[2].hide();ch_label[2].hide();ch[3].hide();ch_label[3].hide();ch[4].hide();ch_label[4].hide();ch[5].hide();ch_label[5].hide();});}};ch[0].onBlur=function(){ch[0].root.getHTMLElement().removeAttribute("style");};}else{hide(0);}if(result_group.length>start_id+1){get(1,start_id+1);ch[1].onFocus=function(){ch[1].setFocus("image/ch_focus.png");pageupdown();current_block=1;accedo.device.manager.unregisterKey("right");accedo.device.manager.unregisterKey("left");accedo.device.manager.unregisterKey("up");accedo.device.manager.unregisterKey("down");if(start+2==result_group.length){ch[2].hide();ch_label[2].hide();}if(start+3==result_group.length){ch[3].hide();ch_label[3].hide();}if(start+4==result_group.length){ch[4].hide();ch_label[4].hide();}if(start+5==result_group.length){ch[5].hide();ch_label[5].hide();}if(start-6>-1){accedo.device.manager.registerKey("up",function(){start=start-6;showchannel(start);accedo.focus.manager.requestFocus(ch[4]);});}if(start+3+1<result_group.length){accedo.device.manager.registerKey("down",function(){accedo.focus.manager.requestFocus(ch[4]);});}else{if(start+3<result_group.length){accedo.device.manager.registerKey("down",function(){accedo.focus.manager.requestFocus(ch[3]);});}else{accedo.device.manager.registerKey("down",function(){});}}if(start+1+1>=result_group.length){accedo.device.manager.registerKey("right",function(){accedo.focus.manager.requestFocus(ch[1]);ch[2].hide();ch_label[2].hide();ch[3].hide();ch_label[3].hide();ch[4].hide();ch_label[4].hide();ch[5].hide();ch_label[5].hide();});}};ch[1].onBlur=function(){ch[1].root.getHTMLElement().removeAttribute("style");};}else{hide(1);}if(result_group.length>start_id+2){get(2,start_id+2);ch[2].onFocus=function(){ch[2].setFocus("image/ch_focus.png");pageupdown();current_block=2;accedo.device.manager.unregisterKey("right");accedo.device.manager.unregisterKey("left");accedo.device.manager.unregisterKey("up");accedo.device.manager.unregisterKey("down");if(start+3==result_group.length){ch[3].hide();ch_label[3].hide();}if(start+4==result_group.length){ch[4].hide();ch_label[4].hide();}if(start+5==result_group.length){ch[5].hide();ch_label[5].hide();}if(start-6>-1){accedo.device.manager.registerKey("up",function(){start=start-6;showchannel(start);accedo.focus.manager.requestFocus(ch[5]);});}if(start+3+2<result_group.length){accedo.device.manager.registerKey("down",function(){accedo.focus.manager.requestFocus(ch[5]);});}else{if(start+3+1<result_group.length){accedo.device.manager.registerKey("down",function(){accedo.focus.manager.requestFocus(ch[4]);});}else{if(start+3<result_group.length){accedo.device.manager.registerKey("down",function(){accedo.focus.manager.requestFocus(ch[3]);});}else{accedo.device.manager.registerKey("down",function(){});}}}if(start+1+2>=result_group.length){accedo.device.manager.registerKey("right",function(){accedo.focus.manager.requestFocus(ch[2]);ch[3].hide();ch_label[3].hide();ch[4].hide();ch_label[4].hide();ch[5].hide();ch_label[5].hide();});}};ch[2].onBlur=function(){ch[2].root.getHTMLElement().removeAttribute("style");};}else{hide(2);}if(result_group.length>start_id+3){get(3,start_id+3);ch[3].onFocus=function(){ch[3].setFocus("image/ch_focus.png");pageupdown();current_block=3;accedo.device.manager.unregisterKey("right");accedo.device.manager.unregisterKey("left");accedo.device.manager.unregisterKey("up");accedo.device.manager.unregisterKey("down");if(start+4==result_group.length){ch[4].hide();ch_label[4].hide();}if(start+5==result_group.length){ch[5].hide();ch_label[5].hide();}if(start+2<result_group.length){accedo.device.manager.registerKey("left",function(){accedo.focus.manager.requestFocus(ch[2]);});}if(start>-1){accedo.device.manager.registerKey("up",function(){accedo.focus.manager.requestFocus(ch[0]);});}if(start+6<result_group.length){accedo.device.manager.registerKey("down",function(){start=start+6;showchannel(start);accedo.focus.manager.requestFocus(ch[0]);});}if(start+4>=result_group.length){accedo.device.manager.registerKey("right",function(){accedo.focus.manager.requestFocus(ch[3]);ch[4].hide();ch_label[4].hide();ch[5].hide();ch_label[5].hide();});}};ch[3].onBlur=function(){ch[3].root.getHTMLElement().removeAttribute("style");};}else{hide(3);}if(result_group.length>start_id+4){get(4,start_id+4);ch[4].onFocus=function(){ch[4].setFocus("image/ch_focus.png");pageupdown();current_block=4;accedo.device.manager.unregisterKey("right");accedo.device.manager.unregisterKey("left");accedo.device.manager.unregisterKey("up");accedo.device.manager.unregisterKey("down");if(start+5==result_group.length){ch[5].hide();ch_label[5].hide();}if(start+3<result_group.length){accedo.device.manager.registerKey("left",function(){accedo.focus.manager.requestFocus(ch[3]);});}if(start>-1){accedo.device.manager.registerKey("up",function(){accedo.focus.manager.requestFocus(ch[1]);});}if(start+6+1<result_group.length){accedo.device.manager.registerKey("down",function(){start=start+6;showchannel(start);accedo.focus.manager.requestFocus(ch[1]);});}else{if(start+6<result_group.length){accedo.device.manager.registerKey("down",function(){start=start+6;showchannel(start);accedo.focus.manager.requestFocus(ch[0]);});}else{accedo.device.manager.registerKey("down",function(){});}}if(start+5>=result_group.length){accedo.device.manager.registerKey("right",function(){accedo.focus.manager.requestFocus(ch[4]);ch[5].hide();ch_label[5].hide();});}};ch[4].onBlur=function(){ch[4].root.getHTMLElement().removeAttribute("style");};}else{hide(4);}if(result_group.length>start_id+5){get(5,start_id+5);ch[5].onFocus=function(){ch[5].setFocus("image/ch_focus.png");pageupdown();current_block=5;accedo.device.manager.unregisterKey("right");accedo.device.manager.unregisterKey("left");accedo.device.manager.unregisterKey("up");accedo.device.manager.unregisterKey("down");if(start+4<result_group.length){accedo.device.manager.registerKey("left",function(){accedo.focus.manager.requestFocus(ch[4]);});}if(start>-1){accedo.device.manager.registerKey("up",function(){accedo.focus.manager.requestFocus(ch[2]);});}if(start+6+2<result_group.length){accedo.device.manager.registerKey("down",function(){start=start+6;showchannel(start);accedo.focus.manager.requestFocus(ch[2]);});}else{if(start+6+1<result_group.length){accedo.device.manager.registerKey("down",function(){start=start+6;showchannel(start);accedo.focus.manager.requestFocus(ch[1]);});}else{if(start+6<result_group.length){accedo.device.manager.registerKey("down",function(){start=start+6;showchannel(start);accedo.focus.manager.requestFocus(ch[0]);});}else{accedo.device.manager.registerKey("down",function(){});if(start+6+3==result_group.length){ch[3].hide();ch_label[3].hide();}if(start+6+4==result_group.length){ch[4].hide();ch_label[4].hide();}if(start+6+5==result_group.length){ch[5].hide();ch_label[5].hide();}}}}if(start+6>=result_group.length){accedo.device.manager.registerKey("right",function(){accedo.focus.manager.requestFocus(ch[5]);});}else{if(start+6<result_group.length){accedo.device.manager.registerKey("right",function(){start=start+6;showchannel(start);accedo.focus.manager.requestFocus(ch[0]);});}}};ch[5].onBlur=function(){ch[5].root.getHTMLElement().removeAttribute("style");};}else{hide(5);}}function hide(label){accedo.device.manager.unregisterKey("down");accedo.device.manager.unregisterKey("up");accedo.device.manager.unregisterKey("right");accedo.device.manager.unregisterKey("left");ch[label].hide();ch_label[label].hide();}function get(label_id,channel_id){ch[label_id].show();ch_label[label_id].show();ch[label_id].setSrc(result_group[channel_id].thumbnail);ch_label[label_id].setText(result_group[channel_id].title);ch[label_id].removeAll("click");ch[label_id].addEventListener("click",function(){nfb.config.history.push(3);nfb.config.channel_start_id.push(start);nfb.config.channel_focus_id.push(current_block+1);nfb.config.channel_result_start_id.push(0);nfb.config.channel_result_focus_id.push(0);nfb.config.currentSubcontroller=9;nfb.config.temp=result_group[channel_id].title;nfb.config.sub_id=channel_id;nfb.config.API_channelid=result_group[channel_id].slug;accedo.app.getCurrentController().get("subcontroller").changeToController(nfb.controllers.mostviewedSubcontroller);accedo.utils.fn.delay(function(){accedo.focus.manager.requestFocus(accedo.app.getCurrentController().get("list1"));},0.1);accedo.device.manager.unregisterKey("down");accedo.device.manager.unregisterKey("up");accedo.device.manager.unregisterKey("right");accedo.device.manager.unregisterKey("left");});}up.onFocus=function(){up.setSrc("image/up_focus.png");};up.onBlur=function(){up.setSrc("image/up.png");};down.onFocus=function(){down.setSrc("image/down_focus.png");};down.onBlur=function(){down.setSrc("image/down.png");};up.addEventListener("click",function(){if(start-6>-1){start=start-6;showchannel(start);if(start-1<=-1){up.blur();up.hide();}}});up.root.addEventListener("click",function(){if(start-6>-1){start=start-6;showchannel(start);if(start-1<=-1){up.blur();up.hide();}}});down.addEventListener("click",function(){if(start+6<result_group.length){start=start+6;showchannel(start);if(start+6>=result_group.length){down.blur();down.hide();}}});down.root.addEventListener("click",function(){if(start+6<result_group.length){start=start+6;showchannel(start);if(start+6>=result_group.length){down.blur();down.hide();}}});ch[0].root.addEventListener("mouseout",function(){ch[0].blur();});ch[1].root.addEventListener("mouseout",function(){ch[1].blur();});ch[2].root.addEventListener("mouseout",function(){ch[2].blur();});ch[3].root.addEventListener("mouseout",function(){ch[3].blur();});ch[4].root.addEventListener("mouseout",function(){ch[4].blur();});ch[5].root.addEventListener("mouseout",function(){ch[5].blur();});up.root.addEventListener("mouseout",function(){up.blur();});down.root.addEventListener("mouseout",function(){down.blur();});accedo.app.getCurrentController().get("loading_subcontroller").root.setStyle({display:"none"});}});};});