accedo.define("nfb.controllers.featureSubcontroller",["accedo.utils.object","accedo.utils.dom","accedo.ui.controller","nfb.views.featureSubview"],function(){return function(a){return accedo.utils.object.extend(accedo.ui.controller(a),{onCreate:function(f){var s=new Array();var m=nfb.config.feature_current_id;var o=this;o.setView(nfb.views.featureSubview);try{var k=SERVER.getJSON(nfb.config.url+nfb.config.API_feature+nfb.config.API_key+nfb.config.API_key1);var j=new Image();j.src=k.data[0].img;}catch(u){alert("ERROR:unable to connect the server.Please try again.");this.get("featureSubview").hide();accedo.utils.fn.delay(function(){accedo.focus.manager.requestFocus(accedo.app.getCurrentController().get("cat1"));},0.01);return;}if(k!=null){var d=k.data.length;}var p=this.get("feature_description");var l=this.get("feature_thumb");var r=this.get("feature_title");var y=this.get("feature_subtitle");var x=this.get("leftside");var b=this.get("feature_thumb");var h=this.get("rightside");x.setSrc("image/left.png");h.setSrc("image/right.png");for(var t=0;t<d;t++){var v={film:k.data[t].film_slug,img:k.data[t].img,title:k.data[t].title,description:k.data[t].description,subtitle:k.data[t].sub_title};s[t]=v;}n(m);nfb.config.feature_current_id=0;if(m==0){x.hide();}x.onFocus=function(){if(m>0){x.setSrc("image/left_focus.png");}};x.onBlur=function(){if(m>0){x.setSrc("image/left.png");}};h.onFocus=function(){if(m<d-1){h.setSrc("image/right_focus.png");}};h.onBlur=function(){if(m<d-1){h.setSrc("image/right.png");}};b.onFocus=function(){if(m==0){c("feature_thumb");}else{c("leftside");}};x.root.addEventListener("click",function(){g();});x.addEventListener("click",function(){g();});h.root.addEventListener("click",function(){w();});h.addEventListener("click",function(){w();});b.addEventListener("click",function(){nfb.config.history.push(0);nfb.config.currentSubcontroller=1.1;nfb.config.film=s[m].film;nfb.config.feature_current_id=m;accedo.define(null,["nfb.controllers.mostviewedSubcontroller"],function(){accedo.app.getCurrentController().get("subcontroller").changeToController(nfb.controllers.detailviewSubcontroller);});});b.root.addEventListener("mouseover",function(){accedo.focus.manager.requestFocus(b);});b.root.addEventListener("mouseout",function(){b.blur();});x.root.addEventListener("mouseover",function(){accedo.focus.manager.requestFocus(x);});x.root.addEventListener("mouseout",function(){x.blur();});h.root.addEventListener("mouseover",function(){accedo.focus.manager.requestFocus(h);});h.root.addEventListener("mouseout",function(){h.blur();});function n(D){if(D>=d-1){h.hide();b.setOption("nextRight","");}else{if(D<=0){x.hide();b.setOption("nextLeft","cat1");b.setOption("nextRight","rightside");}else{b.setOption("nextRight","rightside");b.setOption("nextLeft","leftside");}}if(D>-1&&D<=d-1){var z="background-image:url("+s[D].img+"); background-repeat: no-repeat;background-size: 1280px 622px";var A=s[D].description.replace(/<.*?>/g,"");var B=q(A,340);p.setText(B);l.root.getHTMLElement().setAttribute("style","background-image:url("+s[D].img+");background-repeat: no-repeat;background-position: -104px -11px");r.setText(s[D].title);var i=s[D].subtitle.replace(/<.*?>/g,"");var C=q(i,40);y.setText(C);document.body.setAttribute("style",z);}var e=new Image();if(D+1<d){e.src=s[D+1].img;}if(D+2<d){e.src=s[D+2].img;}}function q(i,e){if(i.length>e){if(i.indexOf(" ",e)>0){i=i.substr(0,i.indexOf(" ",e));i=i+" (...)";}}return i;}function g(){h.show();m=m-1;if(m<=0){x.hide();c("feature_thumb");x.setSrc("image/left.png");}n(m);if(m<=0){accedo.focus.manager.requestFocus(b);}else{accedo.focus.manager.requestFocus(x);}}function w(){x.show();c("leftside");m=m+1;if(m>=d-1){h.hide();h.setSrc("image/right.png");}n(m);if(m>=d-1){accedo.focus.manager.requestFocus(b);}else{accedo.focus.manager.requestFocus(h);}}function c(e){accedo.app.getCurrentController().get("cat1").setOption("nextRight",e);accedo.app.getCurrentController().get("cat2").setOption("nextRight",e);accedo.app.getCurrentController().get("cat3").setOption("nextRight",e);accedo.app.getCurrentController().get("cat4").setOption("nextRight",e);accedo.app.getCurrentController().get("cat5").setOption("nextRight",e);accedo.app.getCurrentController().get("cat6").setOption("nextRight",e);accedo.app.getCurrentController().get("cat7").setOption("nextRight",e);}this.addEventListener("attach",function(){});this.addEventListener("detach",function(){});}});};});